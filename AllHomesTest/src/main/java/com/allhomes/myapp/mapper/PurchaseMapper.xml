<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.allhomes.myapp.purchase.PurchaseDaoImp">
	<select id="allPurchaseList" resultType="com.allhomes.myapp.purchase.PurchaseVO">
		select pc_no, pd_no, s_no, userid, num, price, shipping_c, total_p, a_code, pc_date, payment, status, confirm, memo from purchase order by pc_date desc
	</select>
	<select id="selectPurchaseList" resultType="com.allhomes.myapp.purchase.PurchaseJoinVO">
		select pc_no, pd_no, userid, pc_date from purchase
	</select>
	<select id="joinPurchaseReview" resultType="com.allhomes.myapp.purchase.PurchaseVO">
		select p.pc_no, p.userid, p.pc_date, p.o_value, r.img, r.content, r.writedate, r.rating from purchase p, review r where p.userid=r.userid(+) and r.userid(+)=#{userid}
	</select>
	<insert id="insertPurchaseList" parameterType="com.allhomes.myapp.purchase.PurchaseVO">
		insert into purchase(pc_no, pd_no, s_no, userid, num, price, shipping_c, total_p, a_code, pc_date, payment, status, confirm, memo) values(pc_sq.nextval, pd_no=#{pd_no}, s_no=#{s_no}, userid=#{userid}, num=#{num}, price=#{price}, shipping_c=#{shipping_c}, total_p=#{total_p}, a_code=#{a_code}, pc_date=#{pc_date}, payment=#{payment}, status=#{status}, confirm=#{confirm}, memo=#{memo})
	</insert>
	<update id="editPurchaseList" parameterType="com.allhomes.myapp.purchase.PurchaseVO">
	
	</update>
	<update id="editConfirmCheck">
		update purchase set confirm = 'Y' where pc_no=#{pc_no}
	</update>
	<delete id="delPurchaseList" parameterType="com.allhomes.myapp.purchase.PurchaseVO">
	
	</delete>
<!-- 	<select id="joinPurchaseReview" resultType="com.allhomes.myapp.purchase.PurchaseVO">
		select p.pd_no, p.s_no, p.pd_name, p.price, p.discount, p.main_img, p.stock, p.status, p.sub_c, p.pd_img, p.pd_exp, p.shipping_c, r.userid, r.img, r.content, r.writedate, r.rating_price, r.rating_delivery, r.rating_design, r.rating_durability from product p, review r where p.pd_no=r.pd_no and p.s_no=r.s_no;
  	</select> -->
  	<select id="joinPurchase" parameterType="String" resultType="com.allhomes.myapp.purchase.PurchaseJoinVO">
		select * from (select c.pc_no, c.pd_no, c.pc_date, c.userid, r.img, r.content, r.rating, r.s_no, r.writedate 
		from purchase c, review r where c.userid=r.userid) where pc_no=#{pc_no} and userid=#{userid}
  	</select>
  	<select id="purchaseList" parameterType="com.allhomes.myapp.purchase.PurchaseJoinVO" resultType="com.allhomes.myapp.purchase.PurchaseJoinVO">
  		select * from purchase where userid=#{userid} and pd_no=#{pd_no}
  	</select>
</mapper>